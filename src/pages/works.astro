---
import Layout from '../layouts/Layout.astro';
import '../styles/global.css';
import Card from '../components/Card.astro';
---

<Layout title="Works">
    <main>
        <section class="min-h-90screen pt-24">
            <div class="grid grid-cols-1 px-cpc 2xl:px-bpc sm:grid-cols-2 lg:grid-cols-3 gap-3 ">
                    <div class="relative card-container">
                        <a href="/tda">
                            <Card 
                            imagePath="/TDA.webp"
                            videoPath="/00_PREVIEW_TDA.mp4"
                            altText="TDA 2041"
                            title="TDA 2041"
                            context="Professional Project"
                            type="Animation"/>
                        </a>

                    </div>
                    <div class="relative card-container">
                        <a href="/neotape">
                            <Card 
                            imagePath="/NT.webp"
                            videoPath="/00_PREVIEW_NT.mp4"
                            altText="Neotape"
                            title="Neotape"
                            context="Personal Project"
                            type="Motion Design"/>
                        </a>
                    
                    </div>
                    <div class="relative card-container">
                        <a href="/marie_antoinette">
                            <Card 
                            imagePath="/MA_2.webp"
                            videoPath="/00_PREVIEW_MA.mp4"
                            altText="Marie Antoinette"
                            title="Marie Antoinette"
                            context="Personal Project"
                            type="Animation"/>
                        </a>
                    
                    </div>
                    <div class="relative card-container">
                        <a href="/rollerball">
                            <Card 
                            imagePath="/RB.webp"
                            videoPath="/00_PREVIEW_RB.mp4"
                            altText="Rollerball"
                            title="Rollerball Opening Credits"
                            context="Personal Project"
                            type="Motion Design"/>
                        </a>
                    </div>
            </div>
        </section>
    </main>
    <script>
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.group').forEach(group => {
                    const video = group.querySelector('.video');
                    if (!video) return;
                    group.addEventListener('mouseenter', () => {
                        (video as HTMLVideoElement).play();
                    });
                    group.addEventListener('mouseleave', () => {
                        (video as HTMLVideoElement).pause();
                        setTimeout(() => {
                            (video as HTMLVideoElement).currentTime = 0;
                    }, 150);})
                    });
                });


                // Fade-in animation
                const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const cardContainer = entry.target;
                    const img = cardContainer.querySelector('img');
                    
                    if (img) {
                        // Check if image is already loaded
                        if (img.complete && img.naturalHeight !== 0) {
                            cardContainer.classList.add('fade-in');
                            observer.unobserve(cardContainer);
                        } else {
                            // Wait for image to load
                            img.addEventListener('load', () => {
                                cardContainer.classList.add('fade-in');
                                observer.unobserve(cardContainer);
                            });
                            
                            // Handle error case
                            img.addEventListener('error', () => {
                                cardContainer.classList.add('fade-in');
                                observer.unobserve(cardContainer);
                            });
                        }
                    } else {
                        // No image found, proceed with animation
                        cardContainer.classList.add('fade-in');
                        observer.unobserve(cardContainer);
                    }
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.card-container').forEach(card => {
            observer.observe(card);
        });
    </script>
</Layout>
